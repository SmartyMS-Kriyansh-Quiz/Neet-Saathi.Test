<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NEET-Sathi Test</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; background: #f7f7f7; }
    .container { max-width: 800px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1);}
    .timer-box { display: flex; justify-content: space-between; align-items: center; }
    .marking { text-align: right; font-size: 14px; }
    .question img { max-width: 100%; }
    .btn { padding: 10px 20px; margin: 10px; border: none; background: #007bff; color: white; border-radius: 5px; cursor: pointer; }
    .btn:hover { background: #0056b3; }
    .result-box { text-align: center; margin-top: 20px; }
  </style>
</head>
<body>

<div class="container" id="start-screen">
  <h2>Welcome to NEET-Sathi Test</h2>
  <p>Enter your details to start:</p>
  <input type="text" id="name" placeholder="Enter Your Name" required><br><br>
  <input type="text" id="roll" placeholder="Enter Roll Number" required><br><br>
  <button class="btn" onclick="startTest()">Start Test</button>
</div>

<div class="container" id="quiz-screen" style="display:none;">
  <div class="timer-box">
    <h3 id="timer">Time: 00:00</h3>
    <div class="marking">
      <strong>Marking Scheme</strong><br>
      If Correct: +4 Marks<br>
      If Wrong: â€“1 Mark
    </div>
  </div>
  <hr>

  <div id="questions"></div>

  <button class="btn" onclick="submitTest()">Submit Test</button>
</div>

<div class="container" id="result-screen" style="display:none;">
  <h2>Test Completed</h2>
  <p id="score-display"></p>
  <button class="btn" onclick="window.location.href='leaderboard.html'">View Leaderboard</button>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js"></script>
<script>
let questions = [];
let currentIndex = 0;
let correctAnswers = {};
let userAnswers = {};
let score = 0;
let timerInterval;
let timeLeft = 60 * 10; // 10 min default

// Load questions from test.pdf
async function loadPDF() {
  const pdf = await pdfjsLib.getDocument('test.pdf').promise;
  let textContent = '';
  for (let i = 1; i <= pdf.numPages; i++) {
    let page = await pdf.getPage(i);
    let text = await page.getTextContent();
    text.items.forEach(item => textContent += item.str + '\n');
  }
  // Here you should parse textContent into questions
  // Example: convert to array
  questions = textContent.split('\n').filter(q => q.trim() !== '');
  renderQuestions();
}

function renderQuestions() {
  const container = document.getElementById('questions');
  container.innerHTML = '';
  questions.forEach((q, index) => {
    container.innerHTML += `
      <div class="question">
        <p><b>Q${index+1}.</b> ${q}</p>
        <input type="radio" name="q${index}" value="A"> A
        <input type="radio" name="q${index}" value="B"> B
        <input type="radio" name="q${index}" value="C"> C
        <input type="radio" name="q${index}" value="D"> D
      </div><hr>`;
  });
}

function startTest() {
  document.getElementById('start-screen').style.display = 'none';
  document.getElementById('quiz-screen').style.display = 'block';
  loadPDF();
  startTimer();
}

function startTimer() {
  timerInterval = setInterval(() => {
    let minutes = Math.floor(timeLeft / 60);
    let seconds = timeLeft % 60;
    document.getElementById('timer').innerText = 
      `Time: ${minutes}:${seconds < 10 ? '0'+seconds : seconds}`;
    if (timeLeft <= 0) {
      clearInterval(timerInterval);
      submitTest();
    }
    timeLeft--;
  }, 1000);
}

function submitTest() {
  clearInterval(timerInterval);
  score = 0;
  questions.forEach((q, index) => {
    let selected = document.querySelector(`input[name=q${index}]:checked`);
    if (selected) {
      if (selected.value === 'A') { score += 4; } // You can adjust according to correct answer key
      else { score -= 1; }
    }
  });
  document.getElementById('quiz-screen').style.display = 'none';
  document.getElementById('result-screen').style.display = 'block';
  document.getElementById('score-display').innerText = 
    `Your Score: ${score} Marks`;
  saveToLeaderboard();
}

function saveToLeaderboard() {
  let name = document.getElementById('name').value;
  let roll = document.getElementById('roll').value;
  let data = JSON.parse(localStorage.getItem('leaderboard') || '[]');
  data.push({name, roll, score});
  localStorage.setItem('leaderboard', JSON.stringify(data));
}
</script>

</body>
</html>
